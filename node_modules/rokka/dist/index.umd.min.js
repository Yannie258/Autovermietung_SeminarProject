!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("cross-fetch"),require("form-data")):"function"==typeof define&&define.amd?define(["cross-fetch","form-data"],t):(e=e||self).rokka=t(e.fetch,e.FormData)}(this,(function(e,t){"use strict";e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e,t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t;var r=(t,r)=>{let s=3,a=1e3,i=[429,502,503,504];if(r&&void 0!==r.retries){if(!n(r.retries))throw new o("retries must be a positive integer");s=r.retries}if(r&&void 0!==r.retryDelay){if(!n(r.retryDelay)&&"function"!=typeof r.retryDelay)throw new o("retryDelay must be a positive integer or a function returning a positive integer");a=r.retryDelay}if(r&&r.retryOn){if(!Array.isArray(r.retryOn)&&"function"!=typeof r.retryOn)throw new o("retryOn property expects an array or function");i=r.retryOn}return new Promise((function(n,o){const u=function(a){e(t,r).then((function(e){if(!Array.isArray(i)||-1!==i.indexOf(e.status))return"function"==typeof i?i(a,null,e)?void c(a,null,e):void n(e):void(a<s?c(a,null,e):n(e));n(e)})).catch((function(e){if("function"==typeof i)return i(a,e,null)?void c(a,e,null):void o(e);a<s?c(a,e,null):o(e)}))};function c(e,t,r){const n="function"==typeof a?a(e,t,r):a;setTimeout((function(){u(++e)}),n)}u(0)}))};function n(e){return Number.isInteger(e)&&e>=0}function o(e){this.name="ArgumentError",this.message=e}var s=e=>{const t={};return t.getUrl=(t,r,n,o)=>`${e.renderHost.replace("{organization}",t)}/${(Array.isArray(o)?"dynamic/"+function(e){return(e=Array.isArray(e)?e:[e]).map(e=>{const t=e.name,r=Object.keys(e.options||{}).map(t=>`${t}-${e.options[t]}`).join("-");return r?`${t}-${r}`:t}).join("--")}(o):o)||"dynamic/noop"}/${r}.${n}`,{render:t}},a=e=>Object.assign({},(e=>{const t={READ:"read",WRITE:"write",UPLOAD:"upload",ADMIN:"admin"},r={ROLES:t,create:(r,n,o)=>{"string"==typeof o&&(o=[o]),o.forEach(e=>{if(-1===Object.keys(t).map(e=>t[e]).indexOf(e))return Promise.reject(new Error(`Invalid role "${e}"`))});const s=`organizations/${r}/memberships/${n}`;return e.request("PUT",s,{roles:o})},delete:(t,r)=>{const n=`organizations/${t}/memberships/${r}`;return e.request("DELETE",n)},createWithNewUser:(r,n)=>{n.forEach(e=>{if(-1===Object.keys(t).map(e=>t[e]).indexOf(e))return Promise.reject(new Error(`Invalid role "${e}"`))});const o=`organizations/${r}/memberships`;return e.request("POST",o,{roles:n})},list:t=>{const r=`organizations/${t}/memberships`;return e.request("GET",r)},get:(t,r)=>{const n=`organizations/${t}/memberships/${r}`;return e.request("GET",n)}};return{memberships:r}})(e),(e=>{const t={resize:(e,t,r={})=>(r.width=e,r.height=t,{name:"resize",options:r}),autorotate:(e={})=>({name:"autorotate",options:e}),rotate:(e,t={})=>(t.angle=e,{name:"rotate",options:t}),dropshadow:(e={})=>({name:"dropshadow",options:e}),trim:(e={})=>({name:"trim",options:e}),crop:(e,t,r={})=>(r.width=e,r.height=t,{name:"crop",options:r}),noop:()=>({name:"noop"}),composition:(e,t,r,n={})=>(n.width=e,n.height=t,n.mode=r,{name:"composition",options:n}),blur:(e,t)=>({name:"blur",options:{sigma:e,radius:t}}),list:()=>e.request("GET","operations",null,null,{noAuthHeaders:!0})};return{operations:t}})(e),(e=>{const t={get:t=>e.request("GET","organizations/"+t),create:(t,r,n)=>e.request("PUT","organizations/"+t,{billing_email:r,display_name:n})};return{organizations:t}})(e),(e=>{const t={default:(e,t)=>({expression:e,overrides:{options:t}})};return{expressions:t}})(),s(e),(e=>{const t={meta:{},list:(t,{limit:r=null,offset:n=null,sort:o=null,search:s=null,facets:a=null,deleted:i=null}={})=>{let u={};return null!==r&&(u.limit=r),null!==n&&(u.offset=n),null!==a&&(u.facets=a),null!==i&&(u.deleted=i),null!==o&&(Array.isArray(o)&&(o=o.join(",")),u.sort=o),null!==s&&(u=Object.assign(u,s)),e.request("GET","sourceimages/"+t,null,u)},get:(t,r,n={})=>e.request("GET",`sourceimages/${t}/${r}`,null,n),getWithBinaryHash:(t,r)=>{const n={binaryHash:r};return e.request("GET","sourceimages/"+t,null,n)},download:(t,r)=>e.request("GET",`sourceimages/${t}/${r}/download`),autolabel:(t,r)=>e.request("POST",`sourceimages/${t}/${r}/autolabel`),create:(t,r,n,o=null,s={})=>{const a={multipart:!0};return new Promise(e=>{if(null!==(t=n)&&"object"==typeof t&&"function"==typeof t.pipe){const t=[];n.on("data",e=>t.push(e)),n.on("end",()=>e(Buffer.concat(t)))}else e(n);var t}).then(n=>{const i={...s};null!==o&&Object.keys(o).forEach((function(e){const t=o[e];i[e+"[0]"]="string"==typeof t?t:JSON.stringify(t)}));const u={name:"filedata",formData:i,filename:r,contents:n};return e.request("POST","sourceimages/"+t,u,null,a)})},createByUrl:(t,r,n=null,o={})=>{const s={"url[0]":r,...o};return null!==n&&Object.keys(n).forEach((function(e){const t=n[e];s[e+"[0]"]="string"==typeof t?t:JSON.stringify(t)})),e.request("POST","sourceimages/"+t,s,null,{form:!0})},delete:(t,r)=>e.request("DELETE",`sourceimages/${t}/${r}`),deleteWithBinaryHash:(t,r)=>{const n={binaryHash:r};return e.request("DELETE","sourceimages/"+t,null,n)},restore:(t,r)=>e.request("POST",`sourceimages/${t}/${r}/restore`),copy:(t,r,n,o=!0)=>{const s={Destination:n};return o||(s.Overwrite="F"),e.request("COPY",`sourceimages/${t}/${r}`,null,null,{headers:s})},setSubjectArea:(t,r,n,o={})=>(o.deletePrevious=o.deletePrevious?"true":"false",e.request("PUT","sourceimages/"+t+"/"+r+"/meta/dynamic/subject_area",n,o)),removeSubjectArea:(t,r,n={})=>(n.deletePrevious=n.deletePrevious?"true":"false",e.request("DELETE",`sourceimages/${t}/${r}/meta/dynamic/subject_area`,null,n))};return t.meta.add=(t,r,n)=>e.request("PATCH",`sourceimages/${t}/${r}/meta/user`,n),t.meta.replace=(t,r,n)=>e.request("PUT",`sourceimages/${t}/${r}/meta/user`,n),t.meta.delete=(t,r,n=null)=>{const o=n?"/"+n:"";return e.request("DELETE",`sourceimages/${t}/${r}/meta/user${o}`)},{sourceimages:t}})(e),(e=>{const t={get:()=>e.request("GET","stackoptions",null,null,{noAuthHeaders:!0})};return{stackoptions:t}})(e),(e=>{const t={list:(t,r=null,n=null)=>{const o={};return null!==r&&(o.limit=r),null!==n&&(o.offset=n),e.request("GET","stacks/"+t,null,o)},get:(t,r)=>e.request("GET",`stacks/${t}/${r}`),create:(t,r,n,o={},...s)=>{let a=Object.assign({},o),i={};if(Array.isArray(n)){i.operations=n,i.options=o;const e=s.length>0&&s[0];a={},e&&(a.overwrite=e)}else i=n;return e.request("PUT",`stacks/${t}/${r}`,i,a)},delete:(t,r)=>e.request("DELETE",`stacks/${t}/${r}`)};return{stacks:t}})(e),(e=>{const t={get:(t,r=null,n=null)=>e.request("GET","stats/"+t,null,{from:r,to:n})};return{stats:t}})(e),(e=>{const t={create:(t,r=null)=>e.request("POST","users",{email:t,organization:r},null,{noAuthHeaders:!0}),getId:()=>e.request("GET","user").then(e=>e.body.user_id)};return{users:t}})(e),(e=>{const t={get:(t,r=null,n=null)=>e.request("GET","billing/"+t,null,{from:r,to:n})};return{billing:t}})(e)),i=(e={})=>({response:e,body:null,get statusCode(){return this.response.status},get statusMessage(){return this.response.statusText}});var u=new RegExp("%[a-f0-9]{2}","gi"),c=new RegExp("(%[a-f0-9]{2})+","gi");function l(e,t){try{return decodeURIComponent(e.join(""))}catch(e){}if(1===e.length)return e;t=t||1;var r=e.slice(0,t),n=e.slice(t);return Array.prototype.concat.call([],l(r),l(n))}function p(e){try{return decodeURIComponent(e)}catch(n){for(var t=e.match(u),r=1;r<t.length;r++)t=(e=l(t,r).join("")).match(u);return e}}var f=function(e){if("string"!=typeof e)throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof e+"`");try{return e=e.replace(/\+/g," "),decodeURIComponent(e)}catch(t){return function(e){for(var t={"%FE%FF":"��","%FF%FE":"��"},r=c.exec(e);r;){try{t[r[0]]=decodeURIComponent(r[0])}catch(e){var n=p(r[0]);n!==r[0]&&(t[r[0]]=n)}r=c.exec(e)}t["%C2"]="�";for(var o=Object.keys(t),s=0;s<o.length;s++){var a=o[s];e=e.replace(new RegExp(a,"g"),t[a])}return e}(e)}},m=(e,t)=>{if("string"!=typeof e||"string"!=typeof t)throw new TypeError("Expected the arguments to be of type `string`");if(""===t)return[e];const r=e.indexOf(t);return-1===r?[e]:[e.slice(0,r),e.slice(r+t.length)]},d=function(e,t){return e(t={exports:{}},t.exports),t.exports}((function(e,t){function r(e){if("string"!=typeof e||1!==e.length)throw new TypeError("arrayFormatSeparator must be single character string")}function n(e,t){return t.encode?t.strict?encodeURIComponent(e).replace(/[!'()*]/g,e=>"%"+e.charCodeAt(0).toString(16).toUpperCase()):encodeURIComponent(e):e}function o(e,t){return t.decode?f(e):e}function s(e){const t=e.indexOf("#");return-1!==t&&(e=e.slice(0,t)),e}function a(e){const t=(e=s(e)).indexOf("?");return-1===t?"":e.slice(t+1)}function i(e,t){return t.parseNumbers&&!Number.isNaN(Number(e))&&"string"==typeof e&&""!==e.trim()?e=Number(e):!t.parseBooleans||null===e||"true"!==e.toLowerCase()&&"false"!==e.toLowerCase()||(e="true"===e.toLowerCase()),e}function u(e,t){r((t=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},t)).arrayFormatSeparator);const n=function(e){let t;switch(e.arrayFormat){case"index":return(e,r,n)=>{t=/\[(\d*)\]$/.exec(e),e=e.replace(/\[\d*\]$/,""),t?(void 0===n[e]&&(n[e]={}),n[e][t[1]]=r):n[e]=r};case"bracket":return(e,r,n)=>{t=/(\[\])$/.exec(e),e=e.replace(/\[\]$/,""),t?void 0!==n[e]?n[e]=[].concat(n[e],r):n[e]=[r]:n[e]=r};case"comma":case"separator":return(t,r,n)=>{const s="string"==typeof r&&r.includes(e.arrayFormatSeparator),a="string"==typeof r&&!s&&o(r,e).includes(e.arrayFormatSeparator);r=a?o(r,e):r;const i=s||a?r.split(e.arrayFormatSeparator).map(t=>o(t,e)):null===r?r:o(r,e);n[t]=i};default:return(e,t,r)=>{void 0!==r[e]?r[e]=[].concat(r[e],t):r[e]=t}}}(t),s=Object.create(null);if("string"!=typeof e)return s;if(!(e=e.trim().replace(/^[?#&]/,"")))return s;for(const r of e.split("&")){let[e,a]=m(t.decode?r.replace(/\+/g," "):r,"=");a=void 0===a?null:["comma","separator"].includes(t.arrayFormat)?a:o(a,t),n(o(e,t),a,s)}for(const e of Object.keys(s)){const r=s[e];if("object"==typeof r&&null!==r)for(const e of Object.keys(r))r[e]=i(r[e],t);else s[e]=i(r,t)}return!1===t.sort?s:(!0===t.sort?Object.keys(s).sort():Object.keys(s).sort(t.sort)).reduce((e,t)=>{const r=s[t];return Boolean(r)&&"object"==typeof r&&!Array.isArray(r)?e[t]=function e(t){return Array.isArray(t)?t.sort():"object"==typeof t?e(Object.keys(t)).sort((e,t)=>Number(e)-Number(t)).map(e=>t[e]):t}(r):e[t]=r,e},Object.create(null))}t.extract=a,t.parse=u,t.stringify=(e,t)=>{if(!e)return"";r((t=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},t)).arrayFormatSeparator);const o=r=>t.skipNull&&null==e[r]||t.skipEmptyString&&""===e[r],s=function(e){switch(e.arrayFormat){case"index":return t=>(r,o)=>{const s=r.length;return void 0===o||e.skipNull&&null===o||e.skipEmptyString&&""===o?r:null===o?[...r,[n(t,e),"[",s,"]"].join("")]:[...r,[n(t,e),"[",n(s,e),"]=",n(o,e)].join("")]};case"bracket":return t=>(r,o)=>void 0===o||e.skipNull&&null===o||e.skipEmptyString&&""===o?r:null===o?[...r,[n(t,e),"[]"].join("")]:[...r,[n(t,e),"[]=",n(o,e)].join("")];case"comma":case"separator":return t=>(r,o)=>null==o||0===o.length?r:0===r.length?[[n(t,e),"=",n(o,e)].join("")]:[[r,n(o,e)].join(e.arrayFormatSeparator)];default:return t=>(r,o)=>void 0===o||e.skipNull&&null===o||e.skipEmptyString&&""===o?r:null===o?[...r,n(t,e)]:[...r,[n(t,e),"=",n(o,e)].join("")]}}(t),a={};for(const t of Object.keys(e))o(t)||(a[t]=e[t]);const i=Object.keys(a);return!1!==t.sort&&i.sort(t.sort),i.map(r=>{const o=e[r];return void 0===o?"":null===o?n(r,t):Array.isArray(o)?o.reduce(s(r),[]).join("&"):n(r,t)+"="+n(o,t)}).filter(e=>e.length>0).join("&")},t.parseUrl=(e,t)=>{t=Object.assign({decode:!0},t);const[r,n]=m(e,"#");return Object.assign({url:r.split("?")[0]||"",query:u(a(e),t)},t&&t.parseFragmentIdentifier&&n?{fragmentIdentifier:o(n,t)}:{})},t.stringifyUrl=(e,r)=>{r=Object.assign({encode:!0,strict:!0},r);const o=s(e.url).split("?")[0]||"",a=t.extract(e.url),i=t.parse(a,{sort:!1}),u=Object.assign(i,e.query);let c=t.stringify(u,r);c&&(c="?"+c);let l=function(e){let t="";const r=e.indexOf("#");return-1!==r&&(t=e.slice(r)),t}(e.url);return e.fragmentIdentifier&&(l="#"+n(e.fragmentIdentifier,r)),`${o}${c}${l}`}}));d.extract,d.parse,d.stringify,d.parseUrl,d.stringifyUrl;const y="https://api.rokka.io",g="https://{organization}.rokka.io",h=1,b={requestTimeout:3e4,retries:10,minTimeout:1e3,maxTimeout:1e4,randomize:!0,factor:2};return(e={})=>{null!==e.debug&&(r.debug=e.debug);const n={apiKey:e.apiKey,apiHost:e.apiHost||y,apiVersion:e.apiVersion||h,renderHost:e.renderHost||g,transportOptions:Object.assign(b,e.transport),request(e,o,s=null,a=null,u={}){let c=[n.apiHost,o].join("/");!a||0===Object.entries(a).length&&a.constructor===Object||(c+="?"+d.stringify(a));const l=u.headers||{};if(l["Api-Version"]=n.apiVersion,!0!==u.noAuthHeaders){if(!n.apiKey)return Promise.reject(new Error("Missing required property `apiKey`"));l["Api-Key"]=n.apiKey}const p={method:e,headers:l,timeout:n.transportOptions.requestTimeout,retries:n.transportOptions.retries,retryDelay:(e,t,r)=>{const o=n.transportOptions.randomize?Math.random()+1:1,s=Math.round(o*n.transportOptions.minTimeout*Math.pow(n.transportOptions.factor,e));return Math.min(s,n.transportOptions.maxTimeout)}};if(!0===u.form){const e=s||{},r=new t;Object.keys(e).forEach((function(t){r.append(t,e[t])})),p.body=r}else if(!0!==u.multipart)p.json=!0,p.body=s;else{const e=s.formData||{},r=new t;r.append(s.name,s.contents,s.filename),Object.keys(e).forEach((function(t){r.append(t,JSON.stringify(e[t]))})),p.body=r}p.json&&p.body&&"object"==typeof p.body&&(p.body=JSON.stringify(p.body));return r(c,p).then(async e=>{const t=i(e);if(t.body=await(async e=>e.headers&&e.json?"application/json"===e.headers.get("content-type")?e.json():e.text():e.body)(e),e.status>=400)throw t.error=t.body,t.message=e.status+" - "+JSON.stringify(t.body),t;return t})}};return Object.assign({},a(n))}}));
//# sourceMappingURL=index.umd.min.js.map
